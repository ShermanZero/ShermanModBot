"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("colors");
const Discord = require("discord.js");
const fs = require("fs");
const path = require("path");
const Resources_1 = require("./classes/Resources");
const config = require("./resources/config.json");
let client = new Discord.Client();
init();
start();
client.login(config.token);
function init() {
    client.config = config;
    client.usersInSession = new Map();
    client.masterLog = [];
    client.getGuild = function (guildName) {
        return client.usersInSession[guildName];
    };
    client.updateUser = function (content) {
        var guildName = content.hidden.guildname;
        var username = content.hidden.username;
        var guild = client.usersInSession[guildName];
        guild[username] = content;
        Object.defineProperty(content, "hidden", {
            enumerable: false
        });
    };
    client.registerUser = function (content) {
        client.updateUser(content);
        console.log("*Registered [" +
            content.hidden.username.magenta +
            "] to guild [" +
            content.hidden.guildname.magenta +
            "]");
    };
    client.hasUser = function (guild, username) {
        var userGuild = client.usersInSession[Resources_1.default.getGuildNameFromGuild(guild)];
        if (userGuild === null || typeof userGuild === "undefined")
            return false;
        var user = userGuild[username];
        return !(user === null || typeof user === "undefined");
    };
    client.getUserContent = function (guild, username) {
        var guildName = Resources_1.default.getGuildNameFromGuild(guild);
        var userGuild = client.usersInSession[guildName];
        if (userGuild === null) {
            console.error(("!! Could not retrieve [" + username + "'s] guild").red);
            return null;
        }
        if (userGuild[username] === null ||
            typeof userGuild[username] === "undefined") {
            console.error(("!! Could not locate [" + username + "] in [" + guildName + "]").red);
            return null;
        }
        return userGuild[username];
    };
    client.removeUser = function (guild, username) {
        var userGuild = client.usersInSession[Resources_1.default.getGuildNameFromGuild(guild)];
        if (userGuild === null || typeof userGuild === "undefined")
            return;
        userGuild["delete"](username);
    };
    client.deleteUser = function (guild, username) {
        client.removeUser(guild, username);
        Resources_1.default.destroyUserDirectory(guild, username);
    };
}
function start() {
    var eventsPath = path.join(__dirname, "events");
    fs.readdir(eventsPath, function (err, files) {
        if (err)
            return console.error(err);
        files.forEach(function (file) {
            if (!file.endsWith(".js"))
                return;
            var event = require(path.join(__dirname, "events", file));
            var eventName = file.split(".")[0];
            client.on(eventName, event.bind(null, client));
            delete require
                .cache[require.resolve(path.join(__dirname, "events", file))];
        });
    });
    client.commands = new Map();
    var commandsPath = path.join(__dirname, "commands");
    fs.readdir(commandsPath, function (err, files) {
        if (err)
            return console.error(err);
        files.forEach(function (file) {
            if (!file.endsWith(".js"))
                return;
            var props = require(path.join(__dirname, "commands", file));
            var commandName = file.split(".")[0];
            client.commands.set(commandName, props);
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrQkFBZ0I7QUFFaEIsc0NBQXNDO0FBQ3RDLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFFN0IsbURBQXVDO0FBQ3ZDLGtEQUFrRDtBQUVsRCxJQUFJLE1BQU0sR0FBUSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUV2QyxJQUFJLEVBQUUsQ0FBQztBQUNQLEtBQUssRUFBRSxDQUFDO0FBRVIsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7QUFFM0IsU0FBUyxJQUFJO0lBQ1gsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsTUFBTSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBRXRCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsVUFBUyxTQUFpQjtRQUMxQyxPQUFPLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLFVBQVUsR0FBRyxVQUFTLE9BQVk7UUFDdkMsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7UUFDekMsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDdkMsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsT0FBTyxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRTtZQUN2QyxVQUFVLEVBQUUsS0FBSztTQUNsQixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7SUFFRixNQUFNLENBQUMs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QUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdjb2xvcnMnO1xuXG5pbXBvcnQgKiBhcyBEaXNjb3JkIGZyb20gJ2Rpc2NvcmQuanMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHJzcmMgZnJvbSAnLi9jbGFzc2VzL1Jlc291cmNlcyc7XG5pbXBvcnQgKiBhcyBjb25maWcgZnJvbSAnLi9yZXNvdXJjZXMvY29uZmlnLmpzb24nO1xuXG5sZXQgY2xpZW50OiBhbnkgPSBuZXcgRGlzY29yZC5DbGllbnQoKTtcblxuaW5pdCgpO1xuc3RhcnQoKTtcblxuY2xpZW50LmxvZ2luKGNvbmZpZy50b2tlbik7XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIGNsaWVudC5jb25maWcgPSBjb25maWc7XG4gIGNsaWVudC51c2Vyc0luU2Vzc2lvbiA9IG5ldyBNYXAoKTtcbiAgY2xpZW50Lm1hc3RlckxvZyA9IFtdO1xuXG4gIGNsaWVudC5nZXRHdWlsZCA9IGZ1bmN0aW9uKGd1aWxkTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGNsaWVudC51c2Vyc0luU2Vzc2lvbltndWlsZE5hbWVdO1xuICB9O1xuXG4gIGNsaWVudC51cGRhdGVVc2VyID0gZnVuY3Rpb24oY29udGVudDogYW55KSB7XG4gICAgdmFyIGd1aWxkTmFtZSA9IGNvbnRlbnQuaGlkZGVuLmd1aWxkbmFtZTtcbiAgICB2YXIgdXNlcm5hbWUgPSBjb250ZW50LmhpZGRlbi51c2VybmFtZTtcbiAgICB2YXIgZ3VpbGQgPSBjbGllbnQudXNlcnNJblNlc3Npb25bZ3VpbGROYW1lXTtcbiAgICBndWlsZFt1c2VybmFtZV0gPSBjb250ZW50O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb250ZW50LCBcImhpZGRlblwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH0pO1xuICB9O1xuXG4gIGNsaWVudC5yZWdpc3RlclVzZXIgPSBmdW5jdGlvbihjb250ZW50OiBhbnkpIHtcbiAgICBjbGllbnQudXBkYXRlVXNlcihjb250ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIFwiKlJlZ2lzdGVyZWQgW1wiICtcbiAgICAgICAgY29udGVudC5oaWRkZW4udXNlcm5hbWUubWFnZW50YSArXG4gICAgICAgIFwiXSB0byBndWlsZCBbXCIgK1xuICAgICAgICBjb250ZW50LmhpZGRlbi5ndWlsZG5hbWUubWFnZW50YSArXG4gICAgICAgIFwiXVwiXG4gICAgKTtcbiAgfTtcblxuICBjbGllbnQuaGFzVXNlciA9IGZ1bmN0aW9uKGd1aWxkOiBEaXNjb3JkLkd1aWxkLCB1c2VybmFtZTogc3RyaW5nKSB7XG4gICAgdmFyIHVzZXJHdWlsZCA9IGNsaWVudC51c2Vyc0luU2Vzc2lvbltyc3JjLmdldEd1aWxkTmFtZUZyb21HdWlsZChndWlsZCldO1xuICAgIGlmICh1c2VyR3VpbGQgPT09IG51bGwgfHwgdHlwZW9mIHVzZXJHdWlsZCA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuIGZhbHNlO1xuXG4gICAgdmFyIHVzZXIgPSB1c2VyR3VpbGRbdXNlcm5hbWVdO1xuICAgIHJldHVybiAhKHVzZXIgPT09IG51bGwgfHwgdHlwZW9mIHVzZXIgPT09IFwidW5kZWZpbmVkXCIpO1xuICB9O1xuXG4gIGNsaWVudC5nZXRVc2VyQ29udGVudCA9IGZ1bmN0aW9uKGd1aWxkOiBEaXNjb3JkLkd1aWxkLCB1c2VybmFtZTogc3RyaW5nKSB7XG4gICAgdmFyIGd1aWxkTmFtZSA9IHJzcmMuZ2V0R3VpbGROYW1lRnJvbUd1aWxkKGd1aWxkKTtcbiAgICB2YXIgdXNlckd1aWxkID0gY2xpZW50LnVzZXJzSW5TZXNzaW9uW2d1aWxkTmFtZV07XG5cbiAgICBpZiAodXNlckd1aWxkID09PSBudWxsKSB7XG4gICAgICBjb25zb2xlLmVycm9yKChcIiEhIENvdWxkIG5vdCByZXRyaWV2ZSBbXCIgKyB1c2VybmFtZSArIFwiJ3NdIGd1aWxkXCIpLnJlZCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICB1c2VyR3VpbGRbdXNlcm5hbWVdID09PSBudWxsIHx8XG4gICAgICB0eXBlb2YgdXNlckd1aWxkW3VzZXJuYW1lXSA9PT0gXCJ1bmRlZmluZWRcIlxuICAgICkge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgKFwiISEgQ291bGQgbm90IGxvY2F0ZSBbXCIgKyB1c2VybmFtZSArIFwiXSBpbiBbXCIgKyBndWlsZE5hbWUgKyBcIl1cIikucmVkXG4gICAgICApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVzZXJHdWlsZFt1c2VybmFtZV07XG4gIH07XG5cbiAgY2xpZW50LnJlbW92ZVVzZXIgPSBmdW5jdGlvbihndWlsZDogRGlzY29yZC5HdWlsZCwgdXNlcm5hbWU6IHN0cmluZykge1xuICAgIHZhciB1c2VyR3VpbGQgPSBjbGllbnQudXNlcnNJblNlc3Npb25bcnNyYy5nZXRHdWlsZE5hbWVGcm9tR3VpbGQoZ3VpbGQpXTtcbiAgICBpZiAodXNlckd1aWxkID09PSBudWxsIHx8IHR5cGVvZiB1c2VyR3VpbGQgPT09IFwidW5kZWZpbmVkXCIpIHJldHVybjtcblxuICAgIHVzZXJHdWlsZFtcImRlbGV0ZVwiXSh1c2VybmFtZSk7XG4gIH07XG5cbiAgY2xpZW50LmRlbGV0ZVVzZXIgPSBmdW5jdGlvbihndWlsZDogRGlzY29yZC5HdWlsZCwgdXNlcm5hbWU6IHN0cmluZykge1xuICAgIGNsaWVudC5yZW1vdmVVc2VyKGd1aWxkLCB1c2VybmFtZSk7XG4gICAgcnNyYy5kZXN0cm95VXNlckRpcmVjdG9yeShndWlsZCwgdXNlcm5hbWUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBzdGFydCgpIHtcbiAgdmFyIGV2ZW50c1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBcImV2ZW50c1wiKTtcbiAgZnMucmVhZGRpcihldmVudHNQYXRoLCBmdW5jdGlvbihlcnIsIGZpbGVzKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIGlmICghZmlsZS5lbmRzV2l0aChcIi5qc1wiKSkgcmV0dXJuO1xuICAgICAgdmFyIGV2ZW50ID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcImV2ZW50c1wiLCBmaWxlKSk7XG4gICAgICB2YXIgZXZlbnROYW1lID0gZmlsZS5zcGxpdChcIi5cIilbMF07XG4gICAgICBjbGllbnQub24oZXZlbnROYW1lLCBldmVudC5iaW5kKG51bGwsIGNsaWVudCkpO1xuICAgICAgZGVsZXRlIHJlcXVpcmVcbiAgICAgICAgLmNhY2hlW3JlcXVpcmUucmVzb2x2ZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcImV2ZW50c1wiLCBmaWxlKSldO1xuICAgIH0pO1xuICB9KTtcblxuICBjbGllbnQuY29tbWFuZHMgPSBuZXcgTWFwKCk7XG4gIHZhciBjb21tYW5kc1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBcImNvbW1hbmRzXCIpO1xuXG4gIGZzLnJlYWRkaXIoY29tbWFuZHNQYXRoLCBmdW5jdGlvbihlcnIsIGZpbGVzKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIGlmICghZmlsZS5lbmRzV2l0aChcIi5qc1wiKSkgcmV0dXJuO1xuICAgICAgdmFyIHByb3BzID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcImNvbW1hbmRzXCIsIGZpbGUpKTtcbiAgICAgIHZhciBjb21tYW5kTmFtZSA9IGZpbGUuc3BsaXQoXCIuXCIpWzBdO1xuICAgICAgY2xpZW50LmNvbW1hbmRzLnNldChjb21tYW5kTmFtZSwgcHJvcHMpO1xuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==