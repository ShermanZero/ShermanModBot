"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("colors");
const fs = require("fs");
const path = require("path");
const Resources_1 = require("../classes/Resources");
const blacklist_1 = require("../resources/misc/blacklist");
const ranks_1 = require("../resources/ranks/ranks");
exports.default = (client, message) => {
    var _a;
    if (message.author.bot)
        return;
    if (!registerMessage(client, message))
        return console.error(`!! Could not register message sent by [${Resources_1.default.getUsernameFromMessage(message)}]`.red);
    if (blacklist_1.default.words.some(substring => message.content.includes(substring))) {
        message.delete().catch(err => {
            console.log(err);
        });
        message.reply("that is not allowed here.").catch(err => {
            console.log(err);
        });
    }
    awardExperience(client, message);
    if (message.content.indexOf(client.config.prefix) !== 0)
        return;
    const args = message.content
        .slice(client.config.prefix.length)
        .trim()
        .split(/ +/g);
    let command;
    if (args)
        command = args.shift().toLowerCase();
    if (!command)
        return;
    const cmd = client.commands.get(command);
    if (!cmd)
        return;
    if (cmd.props.requiresElevation && cmd.props.requiresElevation !== "")
        if (!((_a = message.member) === null || _a === void 0 ? void 0 : _a.roles.has(client.config.roles[cmd.props.requiresElevation])))
            return;
    cmd.run(client, message, args);
};
function registerMessage(client, message) {
    let username = Resources_1.default.getUsernameFromMessage(message);
    if (!message.guild)
        return;
    let guildName = Resources_1.default.getGuildNameFromGuild(message.guild);
    let userDir = Resources_1.default.getUserDirectoryFromGuild(message.guild, username);
    let content;
    if (!fs.existsSync(userDir))
        Resources_1.default.createUserDirectory(client, message.guild, message.member);
    if (!client.hasUser(message.guild, username)) {
        content = Resources_1.default.getUserContentsFromName(message, username);
        client.registerUser(message.member.user, content);
    }
    else {
        content = client.getUserContent(message.guild, username);
    }
    if (content === null || typeof content === "undefined") {
        console.error(`!! Could not retrieve contents for [${username}]`.red);
        return false;
    }
    if (content.misc.first_message === null ||
        typeof content.misc.first_message === "undefined") {
        content.misc.first_message = message.content;
        client.updateUser(content);
    }
    let logMessage = `[${getTimestamp(message)}] (#${message.channel.name}): ${message.content}\n`;
    client.masterLog.push(`/${guildName}/>  ${username} ${logMessage}`);
    updateMasterLog(client);
    content.userLog.push(logMessage);
    updateUserLog(client, message.guild, content);
    return true;
}
function getTimestamp(message) {
    let timestamp = message.createdAt;
    let date = (timestamp.getMonth() + 1 + "/" + timestamp.getDate()).replace(/.*(\d{2}\/\d{2}).*/, "$1");
    let time = timestamp.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1");
    return date + "  " + time;
}
function updateMasterLog(client) {
    let masterLog = path.join(__dirname, "..", "logs", client.config.files.log_all);
    if (!fs.existsSync(masterLog))
        fs.writeFileSync(masterLog, "");
    if (client.masterLog.length >= client.config.preferences.log_threshold_master) {
        for (var i = 0; i < client.masterLog.length; i++)
            fs.appendFileSync(masterLog, client.masterLog[i]);
        client.masterLog = [];
    }
}
function updateUserLog(client, guild, content) {
    let logsDir = path.join(Resources_1.default.getUserDirectoryFromGuild(guild, content.hidden.username), "logs");
    let userLog = path.join(logsDir, client.config.files.log_all);
    if (content.userLog.length >= client.config.preferences.log_threshold_user) {
        for (var i = 0; i < content.userLog.length; i++)
            fs.appendFileSync(userLog, content.userLog[i]);
        content.userLog = [];
    }
    client.updateUser(content);
    console.log(`[${content.hidden.guildname.magenta}] =>`, `[${content.hidden.username.magenta}] =>`, content);
}
function awardExperience(client, message) {
    let username = Resources_1.default.getUsernameFromMessage(message);
    let content = client.getUserContent(message.guild, username);
    if (!content) {
        return console.error(`!! Could not retrieve contents from [${username}]`);
    }
    content.rank.xp += 1;
    if (content.rank.xp >= content.rank.levelup) {
        content.rank.level += 1;
        var rank = ranks_1.default.levels[content.rank.level];
        if (rank) {
            var lastRank = content.rank.name;
            content.rank.name = rank;
            let oldRole = message.guild.roles.find(role => role.name.toLowerCase() === lastRank.toLowerCase());
            let newRole = message.guild.roles.find(role => role.name.toLowerCase() === rank.toLowerCase());
            if (oldRole)
                message.member.removeRole(oldRole).catch(err => {
                    console.log(err);
                });
            message.member.addRole(newRole).catch(err => {
                console.log(err);
            });
        }
        content.rank.levelup = Resources_1.default.getXPToLevelUp(content.rank.xp, content.rank.level);
        levelUp(client, message, content);
    }
    client.updateUser(content);
    if (content.rank.xp % client.config.preferences.xp_threshold === 0) {
        let jsonFile = path.join(Resources_1.default.getUserDirectoryFromGuild(message.guild, username), username + ".json");
        let newJson = JSON.stringify(content, null, "\t");
        fs.writeFileSync(jsonFile, newJson);
    }
}
function levelUp(client, message, content) {
    var stats = client.commands.get("stats");
    let embed = stats.getEmbed(client, message.member, content);
    message.channel.send(`Congratulations ${message.author}!  You just leveled up!  Keep chatting to earn more XP and unlock roles and special perks!`);
    message.channel.send(embed);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ldmVudHMvbWVzc2FnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtCQUFnQjtBQUdoQix5QkFBeUI7QUFDekIsNkJBQTZCO0FBRTdCLG9EQUF3QztBQUN4QywyREFBb0Q7QUFDcEQsb0RBQTZDO0FBRTdDLGtCQUFlLENBQUMsTUFBVyxFQUFFLE9BQWdCLEVBQUUsRUFBRTs7SUFFL0MsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUc7UUFBRSxPQUFPO0lBRy9CLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztRQUNuQyxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQ2xCLDBDQUEwQyxtQkFBSSxDQUFDLHNCQUFzQixDQUNuRSxPQUFPLENBQ1IsR0FBRyxDQUFDLEdBQUcsQ0FDVCxDQUFDO0lBR0osSUFBSSxtQkFBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFO1FBQzFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDckQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztLQUNKO0lBRUQsZUFBZSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUdqQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUFFLE9BQU87SUFHaEUsTUFBTSxJQUFJLEdBQVEsT0FBTyxDQUFDLE9BQU87U0FDOUIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUNsQyxJQUFJLEVBQUU7U0FDTixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFaEIsSUFBSSxPQUFZLENBQUM7SUFDakIsSUFBSSxJQUFJO1FBQUUsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUMvQyxJQUFJLENBQUMsT0FBTztRQUFFLE9BQU87SUFHckIsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFHekMsSUFBSSxDQUFDLEdBQUc7UUFBRSxPQUFPO0lBRWpCLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLGlCQUFpQixLQUFLLEVBQUU7UUFDbkUsSUFDRSxRQUFDLE9BQU8sQ0FBQyxNQUFNLDBDQUFFLEtBQUssQ0FBQyxHQUFHLENBQ3hCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsRUFDakQ7WUFFRCxPQUFPO0lBR1gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ2pDLENBQUMsQ0FBQztBQUdGLFNBQVMsZUFBZSxDQUFDLE1BQVcsRUFBRSxPQUFnQjtJQUNwRCxJQUFJLFFBQVEsR0FBRyxtQkFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXBELElBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSztRQUFFLE9BQU87SUFFMUIsSUFBSSxTQUFTLEdBQUcsbUJBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUQsSUFBSSxPQUFPLEdBQUcsbUJBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBRXRFLElBQUksT0FBWSxDQUFDO0lBR2pCLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQztRQUN6QixtQkFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFPLENBQUMsQ0FBQztJQUduRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUFFO1FBQzVDLE9BQU8sR0FBRyxtQkFBSSxDQUFDLHVCQUF1QixDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxNQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBRXBEO1NBQU07UUFDTCxPQUFPLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0tBQzFEO0lBRUQsSUFBSSxPQUFPLEtBQUssSUFBSSxJQUFJLE9BQU8sT0FBTyxLQUFLLFdBQVcsRUFBRTtRQUN0RCxPQUFPLENBQUMsS0FBSyxDQUFDLHVDQUF1QyxRQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0RSxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFDRSxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsS0FBSyxJQUFJO1FBQ25DLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLEtBQUssV0FBVyxFQUNqRDtRQUNBLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDN0MsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUM1QjtJQUVELElBQUksVUFBVSxHQUFHLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxPQUN2QyxPQUFPLENBQUMsT0FBdUIsQ0FBQyxJQUNuQyxNQUFNLE9BQU8sQ0FBQyxPQUFPLElBQUksQ0FBQztJQUcxQixNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLFNBQVMsT0FBTyxRQUFRLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQztJQUVwRSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7SUFHeEIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFakMsYUFBYSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTlDLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLE9BQWdCO0lBQ3BDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDbEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQ3ZFLG9CQUFvQixFQUNwQixJQUFJLENBQ0wsQ0FBQztJQUNGLElBQUksSUFBSSxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxPQUFPLENBQUMseUJBQXlCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFN0UsT0FBTyxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQztBQUM1QixDQUFDO0FBRUQsU0FBUyxlQUFlLENBQUMsTUFBTTtJQUM3QixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUN2QixTQUFTLEVBQ1QsSUFBSSxFQUNKLE1BQU0sRUFDTixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQzVCLENBQUM7SUFFRixJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUcvRCxJQUNFLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLG9CQUFvQixFQUN6RTtRQUNBLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDOUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXBELE1BQU0sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0tBQ3ZCO0FBQ0gsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTztJQUMzQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUNyQixtQkFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUM5RCxNQUFNLENBQ1AsQ0FBQztJQUNGLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRzlELElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsa0JBQWtCLEVBQUU7UUFDMUUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRTtZQUM3QyxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFakQsT0FBTyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7S0FDdEI7SUFHRCxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRzNCLE9BQU8sQ0FBQyxHQUFHLENBQ1QsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLE1BQU0sRUFDMUMsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLE1BQU0sRUFDekMsT0FBTyxDQUNSLENBQUM7QUFDSixDQUFDO0FBR0QsU0FBUyxlQUFlLENBQUMsTUFBTSxFQUFFLE9BQU87SUFDdEMsSUFBSSxRQUFRLEdBQUcsbUJBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUdwRCxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFFN0QsSUFBSSxDQUFDLE9BQU8sRUFBRTtRQUNaLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyx3Q0FBd0MsUUFBUSxHQUFHLENBQUMsQ0FBQztLQUMzRTtJQUVELE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUVyQixJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQzNDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztRQUV4QixJQUFJLElBQUksR0FBRyxlQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsSUFBSSxJQUFJLEVBQUU7WUFDUixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUVqQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDekIsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUNwQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUMzRCxDQUFDO1lBQ0YsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUNwQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUN2RCxDQUFDO1lBRUYsSUFBSSxPQUFPO2dCQUNULE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRTtvQkFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDbkIsQ0FBQyxDQUFDLENBQUM7WUFFTCxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQzFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkIsQ0FBQyxDQUFDLENBQUM7U0FDSjtRQUVELE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLG1CQUFJLENBQUMsY0FBYyxDQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFDZixPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDbkIsQ0FBQztRQUNGLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQ25DO0lBRUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUczQixJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksS0FBSyxDQUFDLEVBQUU7UUFDbEUsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FDdEIsbUJBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUN2RCxRQUFRLEdBQUcsT0FBTyxDQUNuQixDQUFDO1FBQ0YsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2xELEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQ3JDO0FBQ0gsQ0FBQztBQUVELFNBQVMsT0FBTyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTztJQUN2QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN6QyxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTVELE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUNsQixtQkFBbUIsT0FBTyxDQUFDLE1BQU0sNEZBQTRGLENBQzlILENBQUM7SUFDRixPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdjb2xvcnMnO1xyXG5cclxuaW1wb3J0IHsgTWVzc2FnZSwgVGV4dENoYW5uZWwgfSBmcm9tICdkaXNjb3JkLmpzJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuaW1wb3J0IHJzcmMgZnJvbSAnLi4vY2xhc3Nlcy9SZXNvdXJjZXMnO1xyXG5pbXBvcnQgYmxhY2tsaXN0IGZyb20gJy4uL3Jlc291cmNlcy9taXNjL2JsYWNrbGlzdCc7XHJcbmltcG9ydCByYW5rcyBmcm9tICcuLi9yZXNvdXJjZXMvcmFua3MvcmFua3MnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKGNsaWVudDogYW55LCBtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XHJcbiAgLy9pZ25vcmUgYWxsIGJvdHNcclxuICBpZiAobWVzc2FnZS5hdXRob3IuYm90KSByZXR1cm47XHJcblxyXG4gIC8vcmVnaXN0ZXIgdGhlIHVzZXJcclxuICBpZiAoIXJlZ2lzdGVyTWVzc2FnZShjbGllbnQsIG1lc3NhZ2UpKVxyXG4gICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgIGAhISBDb3VsZCBub3QgcmVnaXN0ZXIgbWVzc2FnZSBzZW50IGJ5IFske3JzcmMuZ2V0VXNlcm5hbWVGcm9tTWVzc2FnZShcclxuICAgICAgICBtZXNzYWdlXHJcbiAgICAgICl9XWAucmVkXHJcbiAgICApO1xyXG5cclxuICAvL2NoZWNrIGFnYWluc3QgYmxhY2tsaXN0XHJcbiAgaWYgKGJsYWNrbGlzdC53b3Jkcy5zb21lKHN1YnN0cmluZyA9PiBtZXNzYWdlLmNvbnRlbnQuaW5jbHVkZXMoc3Vic3RyaW5nKSkpIHtcclxuICAgIG1lc3NhZ2UuZGVsZXRlKCkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG4gICAgbWVzc2FnZS5yZXBseShcInRoYXQgaXMgbm90IGFsbG93ZWQgaGVyZS5cIikuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXdhcmRFeHBlcmllbmNlKGNsaWVudCwgbWVzc2FnZSk7XHJcblxyXG4gIC8vaWdub3JlIG1lc3NhZ2VzIG5vdCBzdGFydGluZyB3aXRoIHRoZSBwcmVmaXhcclxuICBpZiAobWVzc2FnZS5jb250ZW50LmluZGV4T2YoY2xpZW50LmNvbmZpZy5wcmVmaXgpICE9PSAwKSByZXR1cm47XHJcblxyXG4gIC8vc3RhbmRhcmQgYXJndW1lbnQvY29tbWFuZCBuYW1lIGRlZmluaXRpb25cclxuICBjb25zdCBhcmdzOiBhbnkgPSBtZXNzYWdlLmNvbnRlbnRcclxuICAgIC5zbGljZShjbGllbnQuY29uZmlnLnByZWZpeC5sZW5ndGgpXHJcbiAgICAudHJpbSgpXHJcbiAgICAuc3BsaXQoLyArL2cpO1xyXG5cclxuICBsZXQgY29tbWFuZDogYW55O1xyXG4gIGlmIChhcmdzKSBjb21tYW5kID0gYXJncy5zaGlmdCgpLnRvTG93ZXJDYXNlKCk7XHJcbiAgaWYgKCFjb21tYW5kKSByZXR1cm47XHJcblxyXG4gIC8vZ3JhYiB0aGUgY29tbWFuZCBkYXRhIGZyb20gdGhlIGNsaWVudC5jb21tYW5kcyBFbm1hcFxyXG4gIGNvbnN0IGNtZCA9IGNsaWVudC5jb21tYW5kcy5nZXQoY29tbWFuZCk7XHJcblxyXG4gIC8vaWYgdGhlIGNvbW1hbmQgZG9lc24ndCBleGlzdFxyXG4gIGlmICghY21kKSByZXR1cm47XHJcblxyXG4gIGlmIChjbWQucHJvcHMucmVxdWlyZXNFbGV2YXRpb24gJiYgY21kLnByb3BzLnJlcXVpcmVzRWxldmF0aW9uICE9PSBcIlwiKVxyXG4gICAgaWYgKFxyXG4gICAgICAhbWVzc2FnZS5tZW1iZXI/LnJvbGVzLmhhcyhcclxuICAgICAgICBjbGllbnQuY29uZmlnLnJvbGVzW2NtZC5wcm9wcy5yZXF1aXJlc0VsZXZhdGlvbl1cclxuICAgICAgKVxyXG4gICAgKVxyXG4gICAgICByZXR1cm47XHJcblxyXG4gIC8vcnVuIHRoZSBjb21tYW5kXHJcbiAgY21kLnJ1bihjbGllbnQsIG1lc3NhZ2UsIGFyZ3MpO1xyXG59O1xyXG5cclxuLy9yZWdpc3RlcnMgdGhlIG1lc3NhZ2VcclxuZnVuY3Rpb24gcmVnaXN0ZXJNZXNzYWdlKGNsaWVudDogYW55LCBtZXNzYWdlOiBNZXNzYWdlKSB7XHJcbiAgbGV0IHVzZXJuYW1lID0gcnNyYy5nZXRVc2VybmFtZUZyb21NZXNzYWdlKG1lc3NhZ2UpO1xyXG5cclxuICBpZighbWVzc2FnZS5ndWlsZCkgcmV0dXJuO1xyXG4gIFxyXG4gIGxldCBndWlsZE5hbWUgPSByc3JjLmdldEd1aWxkTmFtZUZyb21HdWlsZChtZXNzYWdlLmd1aWxkKTtcclxuICBsZXQgdXNlckRpciA9IHJzcmMuZ2V0VXNlckRpcmVjdG9yeUZyb21HdWlsZChtZXNzYWdlLmd1aWxkLCB1c2VybmFtZSk7XHJcblxyXG4gIGxldCBjb250ZW50OiBhbnk7XHJcblxyXG4gIC8vaWYgdGhlIHVzZXIgaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWRcclxuICBpZiAoIWZzLmV4aXN0c1N5bmModXNlckRpcikpXHJcbiAgICByc3JjLmNyZWF0ZVVzZXJEaXJlY3RvcnkoY2xpZW50LCBtZXNzYWdlLmd1aWxkLCBtZXNzYWdlLm1lbWJlciEpO1xyXG5cclxuICAvL3VzZXIgTk9UIHN0b3JlZCBpbiBsb2NhbCBjbGllbnQgc2Vzc2lvblxyXG4gIGlmICghY2xpZW50Lmhhc1VzZXIobWVzc2FnZS5ndWlsZCwgdXNlcm5hbWUpKSB7XHJcbiAgICBjb250ZW50ID0gcnNyYy5nZXRVc2VyQ29udGVudHNGcm9tTmFtZShtZXNzYWdlLCB1c2VybmFtZSk7XHJcbiAgICBjbGllbnQucmVnaXN0ZXJVc2VyKG1lc3NhZ2UubWVtYmVyIS51c2VyLCBjb250ZW50KTtcclxuICAgIC8vdXNlciBzdG9yZWQgaW4gbG9jYWwgY2xpZW50IHNlc3Npb25cclxuICB9IGVsc2Uge1xyXG4gICAgY29udGVudCA9IGNsaWVudC5nZXRVc2VyQ29udGVudChtZXNzYWdlLmd1aWxkLCB1c2VybmFtZSk7XHJcbiAgfVxyXG5cclxuICBpZiAoY29udGVudCA9PT0gbnVsbCB8fCB0eXBlb2YgY29udGVudCA9PT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY29uc29sZS5lcnJvcihgISEgQ291bGQgbm90IHJldHJpZXZlIGNvbnRlbnRzIGZvciBbJHt1c2VybmFtZX1dYC5yZWQpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgaWYgKFxyXG4gICAgY29udGVudC5taXNjLmZpcnN0X21lc3NhZ2UgPT09IG51bGwgfHxcclxuICAgIHR5cGVvZiBjb250ZW50Lm1pc2MuZmlyc3RfbWVzc2FnZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICkge1xyXG4gICAgY29udGVudC5taXNjLmZpcnN0X21lc3NhZ2UgPSBtZXNzYWdlLmNvbnRlbnQ7XHJcbiAgICBjbGllbnQudXBkYXRlVXNlcihjb250ZW50KTtcclxuICB9XHJcblxyXG4gIGxldCBsb2dNZXNzYWdlID0gYFske2dldFRpbWVzdGFtcChtZXNzYWdlKX1dICgjJHtcclxuICAgIChtZXNzYWdlLmNoYW5uZWwgYXMgVGV4dENoYW5uZWwpLm5hbWVcclxuICB9KTogJHttZXNzYWdlLmNvbnRlbnR9XFxuYDtcclxuXHJcbiAgLy9wdXNoIHRoZSBtZXNzYWdlIHRvIHRoZSBtYXN0ZXIgbG9nIGJyYW5jaFxyXG4gIGNsaWVudC5tYXN0ZXJMb2cucHVzaChgLyR7Z3VpbGROYW1lfS8+ICAke3VzZXJuYW1lfSAke2xvZ01lc3NhZ2V9YCk7XHJcbiAgLy9pZiB0aGUgbG9nIGxlbmd0aCBleGNlZWRzIHRoZSB0aHJlc2hvbGQsIHVwZGF0ZSB0aGUgbWFzdGVyIGxvZ1xyXG4gIHVwZGF0ZU1hc3RlckxvZyhjbGllbnQpO1xyXG5cclxuICAvL3B1c2ggdGhlIHVzZXIncyBtZXNzYWdlIGRpcmVjdGx5IHRvIHRoZSB1c2VyJ3MgbG9nXHJcbiAgY29udGVudC51c2VyTG9nLnB1c2gobG9nTWVzc2FnZSk7XHJcbiAgLy9pZiB0aGUgbG9nIGxlbmd0aCBleGNlZWRzIHRoZSB0aHJlc2hvbGQsIHVwZGF0ZSB0aGUgdXNlciBsb2dcclxuICB1cGRhdGVVc2VyTG9nKGNsaWVudCwgbWVzc2FnZS5ndWlsZCwgY29udGVudCk7XHJcblxyXG4gIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRUaW1lc3RhbXAobWVzc2FnZTogTWVzc2FnZSkge1xyXG4gIGxldCB0aW1lc3RhbXAgPSBtZXNzYWdlLmNyZWF0ZWRBdDtcclxuICBsZXQgZGF0ZSA9ICh0aW1lc3RhbXAuZ2V0TW9udGgoKSArIDEgKyBcIi9cIiArIHRpbWVzdGFtcC5nZXREYXRlKCkpLnJlcGxhY2UoXHJcbiAgICAvLiooXFxkezJ9XFwvXFxkezJ9KS4qLyxcclxuICAgIFwiJDFcIlxyXG4gICk7XHJcbiAgbGV0IHRpbWUgPSB0aW1lc3RhbXAudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvLiooXFxkezJ9OlxcZHsyfTpcXGR7Mn0pLiovLCBcIiQxXCIpO1xyXG5cclxuICByZXR1cm4gZGF0ZSArIFwiICBcIiArIHRpbWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZU1hc3RlckxvZyhjbGllbnQpIHtcclxuICBsZXQgbWFzdGVyTG9nID0gcGF0aC5qb2luKFxyXG4gICAgX19kaXJuYW1lLFxyXG4gICAgXCIuLlwiLFxyXG4gICAgXCJsb2dzXCIsXHJcbiAgICBjbGllbnQuY29uZmlnLmZpbGVzLmxvZ19hbGxcclxuICApO1xyXG5cclxuICBpZiAoIWZzLmV4aXN0c1N5bmMobWFzdGVyTG9nKSkgZnMud3JpdGVGaWxlU3luYyhtYXN0ZXJMb2csIFwiXCIpO1xyXG5cclxuICAvL2lmIHRoZSBsb2cgbGVuZ3RoIGV4Y2VlZHMgdGhlIHRocmVzaG9sZCwgdXBkYXRlIHRoZSBtYXN0ZXIgbG9nXHJcbiAgaWYgKFxyXG4gICAgY2xpZW50Lm1hc3RlckxvZy5sZW5ndGggPj0gY2xpZW50LmNvbmZpZy5wcmVmZXJlbmNlcy5sb2dfdGhyZXNob2xkX21hc3RlclxyXG4gICkge1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbGllbnQubWFzdGVyTG9nLmxlbmd0aDsgaSsrKVxyXG4gICAgICBmcy5hcHBlbmRGaWxlU3luYyhtYXN0ZXJMb2csIGNsaWVudC5tYXN0ZXJMb2dbaV0pO1xyXG5cclxuICAgIGNsaWVudC5tYXN0ZXJMb2cgPSBbXTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVVzZXJMb2coY2xpZW50LCBndWlsZCwgY29udGVudCkge1xyXG4gIGxldCBsb2dzRGlyID0gcGF0aC5qb2luKFxyXG4gICAgcnNyYy5nZXRVc2VyRGlyZWN0b3J5RnJvbUd1aWxkKGd1aWxkLCBjb250ZW50LmhpZGRlbi51c2VybmFtZSksXHJcbiAgICBcImxvZ3NcIlxyXG4gICk7XHJcbiAgbGV0IHVzZXJMb2cgPSBwYXRoLmpvaW4obG9nc0RpciwgY2xpZW50LmNvbmZpZy5maWxlcy5sb2dfYWxsKTtcclxuXHJcbiAgLy9pZiB0aGUgbG9nIGxlbmd0aCBleGNlZWRzIHRoZSB0aHJlc2hvbGQsIHVwZGF0ZSB0aGUgbWFzdGVyIGxvZ1xyXG4gIGlmIChjb250ZW50LnVzZXJMb2cubGVuZ3RoID49IGNsaWVudC5jb25maWcucHJlZmVyZW5jZXMubG9nX3RocmVzaG9sZF91c2VyKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbnRlbnQudXNlckxvZy5sZW5ndGg7IGkrKylcclxuICAgICAgZnMuYXBwZW5kRmlsZVN5bmModXNlckxvZywgY29udGVudC51c2VyTG9nW2ldKTtcclxuXHJcbiAgICBjb250ZW50LnVzZXJMb2cgPSBbXTtcclxuICB9XHJcblxyXG4gIC8vaGF2ZSB0byB1cGRhdGUgdGhlIEVubWFwXHJcbiAgY2xpZW50LnVwZGF0ZVVzZXIoY29udGVudCk7XHJcblxyXG4gIC8vbG9nIGl0IHRvIHRoZSBjb25zb2xlXHJcbiAgY29uc29sZS5sb2coXHJcbiAgICBgWyR7Y29udGVudC5oaWRkZW4uZ3VpbGRuYW1lLm1hZ2VudGF9XSA9PmAsXHJcbiAgICBgWyR7Y29udGVudC5oaWRkZW4udXNlcm5hbWUubWFnZW50YX1dID0+YCxcclxuICAgIGNvbnRlbnRcclxuICApO1xyXG59XHJcblxyXG4vL2F3YXJkcyB0aGUgdXNlciBleHBlcmllbmNlIGZvciBwb3N0aW5nIGEgbWVzc2FnZVxyXG5mdW5jdGlvbiBhd2FyZEV4cGVyaWVuY2UoY2xpZW50LCBtZXNzYWdlKSB7XHJcbiAgbGV0IHVzZXJuYW1lID0gcnNyYy5nZXRVc2VybmFtZUZyb21NZXNzYWdlKG1lc3NhZ2UpO1xyXG5cclxuICAvL2dldCB0aGUgY29udGVudCBmcm9tIHRoZSBzZXNzaW9uIGluc3RlYWQgb2YgZnJvbSB0aGUgZmlsZVxyXG4gIGxldCBjb250ZW50ID0gY2xpZW50LmdldFVzZXJDb250ZW50KG1lc3NhZ2UuZ3VpbGQsIHVzZXJuYW1lKTtcclxuXHJcbiAgaWYgKCFjb250ZW50KSB7XHJcbiAgICByZXR1cm4gY29uc29sZS5lcnJvcihgISEgQ291bGQgbm90IHJldHJpZXZlIGNvbnRlbnRzIGZyb20gWyR7dXNlcm5hbWV9XWApO1xyXG4gIH1cclxuXHJcbiAgY29udGVudC5yYW5rLnhwICs9IDE7XHJcblxyXG4gIGlmIChjb250ZW50LnJhbmsueHAgPj0gY29udGVudC5yYW5rLmxldmVsdXApIHtcclxuICAgIGNvbnRlbnQucmFuay5sZXZlbCArPSAxO1xyXG5cclxuICAgIHZhciByYW5rID0gcmFua3MubGV2ZWxzW2NvbnRlbnQucmFuay5sZXZlbF07XHJcbiAgICBpZiAocmFuaykge1xyXG4gICAgICB2YXIgbGFzdFJhbmsgPSBjb250ZW50LnJhbmsubmFtZTtcclxuXHJcbiAgICAgIGNvbnRlbnQucmFuay5uYW1lID0gcmFuaztcclxuICAgICAgbGV0IG9sZFJvbGUgPSBtZXNzYWdlLmd1aWxkLnJvbGVzLmZpbmQoXHJcbiAgICAgICAgcm9sZSA9PiByb2xlLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbGFzdFJhbmsudG9Mb3dlckNhc2UoKVxyXG4gICAgICApO1xyXG4gICAgICBsZXQgbmV3Um9sZSA9IG1lc3NhZ2UuZ3VpbGQucm9sZXMuZmluZChcclxuICAgICAgICByb2xlID0+IHJvbGUubmFtZS50b0xvd2VyQ2FzZSgpID09PSByYW5rLnRvTG93ZXJDYXNlKClcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmIChvbGRSb2xlKVxyXG4gICAgICAgIG1lc3NhZ2UubWVtYmVyLnJlbW92ZVJvbGUob2xkUm9sZSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBtZXNzYWdlLm1lbWJlci5hZGRSb2xlKG5ld1JvbGUpLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29udGVudC5yYW5rLmxldmVsdXAgPSByc3JjLmdldFhQVG9MZXZlbFVwKFxyXG4gICAgICBjb250ZW50LnJhbmsueHAsXHJcbiAgICAgIGNvbnRlbnQucmFuay5sZXZlbFxyXG4gICAgKTtcclxuICAgIGxldmVsVXAoY2xpZW50LCBtZXNzYWdlLCBjb250ZW50KTtcclxuICB9XHJcblxyXG4gIGNsaWVudC51cGRhdGVVc2VyKGNvbnRlbnQpO1xyXG5cclxuICAvL29ubHkgd3JpdGUgWFAgY2hhbmdlcyB0byB0aGUgZmlsZSBldmVyeSAxMCBtZXNzYWdlc1xyXG4gIGlmIChjb250ZW50LnJhbmsueHAgJSBjbGllbnQuY29uZmlnLnByZWZlcmVuY2VzLnhwX3RocmVzaG9sZCA9PT0gMCkge1xyXG4gICAgbGV0IGpzb25GaWxlID0gcGF0aC5qb2luKFxyXG4gICAgICByc3JjLmdldFVzZXJEaXJlY3RvcnlGcm9tR3VpbGQobWVzc2FnZS5ndWlsZCwgdXNlcm5hbWUpLFxyXG4gICAgICB1c2VybmFtZSArIFwiLmpzb25cIlxyXG4gICAgKTtcclxuICAgIGxldCBuZXdKc29uID0gSlNPTi5zdHJpbmdpZnkoY29udGVudCwgbnVsbCwgXCJcXHRcIik7XHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKGpzb25GaWxlLCBuZXdKc29uKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxldmVsVXAoY2xpZW50LCBtZXNzYWdlLCBjb250ZW50KSB7XHJcbiAgdmFyIHN0YXRzID0gY2xpZW50LmNvbW1hbmRzLmdldChcInN0YXRzXCIpO1xyXG4gIGxldCBlbWJlZCA9IHN0YXRzLmdldEVtYmVkKGNsaWVudCwgbWVzc2FnZS5tZW1iZXIsIGNvbnRlbnQpO1xyXG5cclxuICBtZXNzYWdlLmNoYW5uZWwuc2VuZChcclxuICAgIGBDb25ncmF0dWxhdGlvbnMgJHttZXNzYWdlLmF1dGhvcn0hICBZb3UganVzdCBsZXZlbGVkIHVwISAgS2VlcCBjaGF0dGluZyB0byBlYXJuIG1vcmUgWFAgYW5kIHVubG9jayByb2xlcyBhbmQgc3BlY2lhbCBwZXJrcyFgXHJcbiAgKTtcclxuICBtZXNzYWdlLmNoYW5uZWwuc2VuZChlbWJlZCk7XHJcbn1cclxuIl19