"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("colors");
const Discord = require("discord.js");
const fs = require("fs");
const path = require("path");
const Resources_1 = require("./classes/Resources");
const global_config_1 = require("./resources/global_config");
let client = new Discord.Client();
init();
start();
client.login(global_config_1.default.token);
function init() {
  client.config = global_config_1.default;
  client.usersInSession = new Map();
  client.masterLog = [];
  client.getGuild = function(guildName) {
    return client.usersInSession[guildName];
  };
  client.updateUser = function(content) {
    var guildName = content.hidden.guildname;
    var username = content.hidden.username;
    var guild = client.usersInSession[guildName];
    guild[username] = content;
    Object.defineProperty(content, "hidden", {
      enumerable: false
    });
  };
  client.registerUser = function(content) {
    client.updateUser(content);
    console.log("*Registered [" + content.hidden.username.magenta + "] to guild [" + content.hidden.guildname.magenta + "]");
  };
  client.hasUser = function(guild, username) {
    var userGuild = client.usersInSession[Resources_1.default.getGuildNameFromGuild(guild)];
    if (userGuild === null || typeof userGuild === "undefined") return false;
    var user = userGuild[username];
    return !(user === null || typeof user === "undefined");
  };
  client.getUserContent = function(guild, username) {
    var guildName = Resources_1.default.getGuildNameFromGuild(guild);
    var userGuild = client.usersInSession[guildName];
    if (userGuild === null) {
      console.error(("!! Could not retrieve [" + username + "'s] guild").red);
      return null;
    }
    if (userGuild[username] === null || typeof userGuild[username] === "undefined") {
      console.error(("!! Could not locate [" + username + "] in [" + guildName + "]").red);
      return null;
    }
    return userGuild[username];
  };
  client.removeUser = function(guild, username) {
    var userGuild = client.usersInSession[Resources_1.default.getGuildNameFromGuild(guild)];
    if (userGuild === null || typeof userGuild === "undefined") return;
    userGuild["delete"](username);
  };
  client.deleteUser = function(guild, username) {
    client.removeUser(guild, username);
    Resources_1.default.destroyUserDirectory(guild, username);
  };
}
function start() {
  var eventsPath = path.join(__dirname, "events");
  fs.readdir(eventsPath, function(err, files) {
    if (err) return console.error(err);
    files.forEach(function(file) {
      if (!file.endsWith(".js")) return;
      var event = require(path.join(__dirname, "events", file));
      var eventName = file.split(".")[0];
      console.log("--registering event", eventName);
      client.on(eventName, event.bind(null, client));
      delete require.cache[require.resolve(path.join(__dirname, "events", file))];
    });
  });
  client.commands = new Map();
  var commandsPath = path.join(__dirname, "commands");
  fs.readdir(commandsPath, function(err, files) {
    if (err) return console.error(err);
    files.forEach(function(file) {
      if (!file.endsWith(".js")) return;
      var props = require(path.join(__dirname, "commands", file));
      var commandName = file.split(".")[0];
      console.log("--registering command", commandName, props);
      client.commands.set(commandName, props);
      console.log("--set command", commandName, props);
    });
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrQkFBZ0I7QUFFaEIsc0NBQXNDO0FBQ3RDLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFFN0IsbURBQXVDO0FBQ3ZDLDZEQUErQztBQUUvQyxJQUFJLE1BQU0sR0FBUSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUV2QyxJQUFJLEVBQUUsQ0FBQztBQUNQLEtBQUssRUFBRSxDQUFDO0FBRVIsTUFBTSxDQUFDLEtBQUssQ0FBQyx1QkFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRTNCLFNBQVMsSUFBSTtJQUNYLE1BQU0sQ0FBQyxNQUFNLEdBQUcsdUJBQU0sQ0FBQztJQUN2QixNQUFNLENBQUMsY0FBYyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDbEMsTUFBTSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFFdEIsTUFBTSxDQUFDLFFBQVEsR0FBRyxVQUFTLFNBQWlCO1FBQzFDLE9BQU8sTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMxQyxDQUFDLENBQUM7SUFFRixNQUFNLENBQUMsVUFBVSxHQUFHLFVBQVMsT0FBWTtRQUN2QyxJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUN6QyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztRQUN2QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzdDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxPQUFPLENBQUM7UUFDMUIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFO1lBQ3ZDLFVBQVUsRUFBRSxLQUFLO1NBQ2xCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztJQUVGLE1BQU0sQ0FBQyxZQUFZLEdBQUcsVUFBUyxPQUFZO1FBQ3pDLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FDVCxlQUFlO1lBQ2IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTztZQUMvQixjQUFjO1lBQ2QsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTztZQUNoQyxHQUFHLENBQ04sQ0FBQztJQUNKLENBQUMsQ0FBQztJQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsVUFBUyxLQUFvQixFQUFFLFFBQWdCO1FBQzlELElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsbUJBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLElBQUksU0FBUyxLQUFLLElBQUksSUFBSSxPQUFPLFNBQVMsS0FBSyxXQUFXO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFekUsSUFBSSxJQUFJLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLE9BQU8sQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLElBQUksT0FBTyxJQUFJLEtBQUssV0FBVyxDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLGNBQWMsR0FBRyxVQUFTLEtBQW9CLEVBQUUsUUFBZ0I7UUFDckUsSUFBSSxTQUFTLEdBQUcsbUJBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsRCxJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWpELElBQUksU0FBUyxLQUFLLElBQUksRUFBRTtZQUN0QixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMseUJBQXlCLEdBQUcsUUFBUSxHQUFHLFdBQVcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxJQUNFLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxJQUFJO1lBQzVCLE9BQU8sU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLFdBQVcsRUFDMUM7WUFDQSxPQUFPLENBQUMsS0FBSyxDQUNYLENBQUMsdUJBQXVCLEdBQUcsUUFBUSxHQUFHLFFBQVEsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUN0RSxDQUFDO1lBQ0YsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQztJQUVGLE1BQU0sQ0FBQyxVQUFVLEdBQUcsVUFBUyxLQUFvQixFQUFFLFFBQWdCO1FBQ2pFLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsbUJBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLElBQUksU0FBUyxLQUFLLElBQUksSUFBSSxPQUFPLFNBQVMsS0FBSyxXQUFXO1lBQUUsT0FBTztRQUVuRSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLFVBQVUsR0FBRyxVQUFTLEtBQW9CLEVBQUUsUUFBZ0I7UUFDakUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbkMsbUJBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsS0FBSztJQUNaLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ2hELEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLFVBQVMsR0FBRyxFQUFFLEtBQUs7UUFDeEMsSUFBSSxHQUFHO1lBQUUsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBUyxJQUFJO1lBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztnQkFBRSxPQUFPO1lBQ2xDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQWEsQ0FBQztZQUN0RSxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRW5DLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUMvQyxPQUFPLE9BQU87aUJBQ1gsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQzVCLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRXBELEVBQUUsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLFVBQVMsR0FBRyxFQUFFLEtBQUs7UUFDMUMsSUFBSSxHQUFHO1lBQUUsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBUyxJQUFJO1lBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztnQkFBRSxPQUFPO1lBQ2xDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM1RCxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXJDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV4QyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ2NvbG9ycyc7XG5cbmltcG9ydCAqIGFzIERpc2NvcmQgZnJvbSAnZGlzY29yZC5qcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgcnNyYyBmcm9tICcuL2NsYXNzZXMvUmVzb3VyY2VzJztcbmltcG9ydCBjb25maWcgZnJvbSAnLi9yZXNvdXJjZXMvZ2xvYmFsX2NvbmZpZyc7XG5cbmxldCBjbGllbnQ6IGFueSA9IG5ldyBEaXNjb3JkLkNsaWVudCgpO1xuXG5pbml0KCk7XG5zdGFydCgpO1xuXG5jbGllbnQubG9naW4oY29uZmlnLnRva2VuKTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgY2xpZW50LmNvbmZpZyA9IGNvbmZpZztcbiAgY2xpZW50LnVzZXJzSW5TZXNzaW9uID0gbmV3IE1hcCgpO1xuICBjbGllbnQubWFzdGVyTG9nID0gW107XG5cbiAgY2xpZW50LmdldEd1aWxkID0gZnVuY3Rpb24oZ3VpbGROYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gY2xpZW50LnVzZXJzSW5TZXNzaW9uW2d1aWxkTmFtZV07XG4gIH07XG5cbiAgY2xpZW50LnVwZGF0ZVVzZXIgPSBmdW5jdGlvbihjb250ZW50OiBhbnkpIHtcbiAgICB2YXIgZ3VpbGROYW1lID0gY29udGVudC5oaWRkZW4uZ3VpbGRuYW1lO1xuICAgIHZhciB1c2VybmFtZSA9IGNvbnRlbnQuaGlkZGVuLnVzZXJuYW1lO1xuICAgIHZhciBndWlsZCA9IGNsaWVudC51c2Vyc0luU2Vzc2lvbltndWlsZE5hbWVdO1xuICAgIGd1aWxkW3VzZXJuYW1lXSA9IGNvbnRlbnQ7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbnRlbnQsIFwiaGlkZGVuXCIsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgfSk7XG4gIH07XG5cbiAgY2xpZW50LnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uKGNvbnRlbnQ6IGFueSkge1xuICAgIGNsaWVudC51cGRhdGVVc2VyKGNvbnRlbnQpO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCIqUmVnaXN0ZXJlZCBbXCIgK1xuICAgICAgICBjb250ZW50LmhpZGRlbi51c2VybmFtZS5tYWdlbnRhICtcbiAgICAgICAgXCJdIHRvIGd1aWxkIFtcIiArXG4gICAgICAgIGNvbnRlbnQuaGlkZGVuLmd1aWxkbmFtZS5tYWdlbnRhICtcbiAgICAgICAgXCJdXCJcbiAgICApO1xuICB9O1xuXG4gIGNsaWVudC5oYXNVc2VyID0gZnVuY3Rpb24oZ3VpbGQ6IERpc2NvcmQuR3VpbGQsIHVzZXJuYW1lOiBzdHJpbmcpIHtcbiAgICB2YXIgdXNlckd1aWxkID0gY2xpZW50LnVzZXJzSW5TZXNzaW9uW3JzcmMuZ2V0R3VpbGROYW1lRnJvbUd1aWxkKGd1aWxkKV07XG4gICAgaWYgKHVzZXJHdWlsZCA9PT0gbnVsbCB8fCB0eXBlb2YgdXNlckd1aWxkID09PSBcInVuZGVmaW5lZFwiKSByZXR1cm4gZmFsc2U7XG5cbiAgICB2YXIgdXNlciA9IHVzZXJHdWlsZFt1c2VybmFtZV07XG4gICAgcmV0dXJuICEodXNlciA9PT0gbnVsbCB8fCB0eXBlb2YgdXNlciA9PT0gXCJ1bmRlZmluZWRcIik7XG4gIH07XG5cbiAgY2xpZW50LmdldFVzZXJDb250ZW50ID0gZnVuY3Rpb24oZ3VpbGQ6IERpc2NvcmQuR3VpbGQsIHVzZXJuYW1lOiBzdHJpbmcpIHtcbiAgICB2YXIgZ3VpbGROYW1lID0gcnNyYy5nZXRHdWlsZE5hbWVGcm9tR3VpbGQoZ3VpbGQpO1xuICAgIHZhciB1c2VyR3VpbGQgPSBjbGllbnQudXNlcnNJblNlc3Npb25bZ3VpbGROYW1lXTtcblxuICAgIGlmICh1c2VyR3VpbGQgPT09IG51bGwpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoKFwiISEgQ291bGQgbm90IHJldHJpZXZlIFtcIiArIHVzZXJuYW1lICsgXCInc10gZ3VpbGRcIikucmVkKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHVzZXJHdWlsZFt1c2VybmFtZV0gPT09IG51bGwgfHxcbiAgICAgIHR5cGVvZiB1c2VyR3VpbGRbdXNlcm5hbWVdID09PSBcInVuZGVmaW5lZFwiXG4gICAgKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAoXCIhISBDb3VsZCBub3QgbG9jYXRlIFtcIiArIHVzZXJuYW1lICsgXCJdIGluIFtcIiArIGd1aWxkTmFtZSArIFwiXVwiKS5yZWRcbiAgICAgICk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdXNlckd1aWxkW3VzZXJuYW1lXTtcbiAgfTtcblxuICBjbGllbnQucmVtb3ZlVXNlciA9IGZ1bmN0aW9uKGd1aWxkOiBEaXNjb3JkLkd1aWxkLCB1c2VybmFtZTogc3RyaW5nKSB7XG4gICAgdmFyIHVzZXJHdWlsZCA9IGNsaWVudC51c2Vyc0luU2Vzc2lvbltyc3JjLmdldEd1aWxkTmFtZUZyb21HdWlsZChndWlsZCldO1xuICAgIGlmICh1c2VyR3VpbGQgPT09IG51bGwgfHwgdHlwZW9mIHVzZXJHdWlsZCA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xuXG4gICAgdXNlckd1aWxkW1wiZGVsZXRlXCJdKHVzZXJuYW1lKTtcbiAgfTtcblxuICBjbGllbnQuZGVsZXRlVXNlciA9IGZ1bmN0aW9uKGd1aWxkOiBEaXNjb3JkLkd1aWxkLCB1c2VybmFtZTogc3RyaW5nKSB7XG4gICAgY2xpZW50LnJlbW92ZVVzZXIoZ3VpbGQsIHVzZXJuYW1lKTtcbiAgICByc3JjLmRlc3Ryb3lVc2VyRGlyZWN0b3J5KGd1aWxkLCB1c2VybmFtZSk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICB2YXIgZXZlbnRzUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsIFwiZXZlbnRzXCIpO1xuICBmcy5yZWFkZGlyKGV2ZW50c1BhdGgsIGZ1bmN0aW9uKGVyciwgZmlsZXMpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY29uc29sZS5lcnJvcihlcnIpO1xuICAgIGZpbGVzLmZvckVhY2goZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKCFmaWxlLmVuZHNXaXRoKFwiLmpzXCIpKSByZXR1cm47XG4gICAgICB2YXIgZXZlbnQgPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsIFwiZXZlbnRzXCIsIGZpbGUpKSBhcyBGdW5jdGlvbjtcbiAgICAgIHZhciBldmVudE5hbWUgPSBmaWxlLnNwbGl0KFwiLlwiKVswXTtcblxuICAgICAgY29uc29sZS5sb2coXCItLXJlZ2lzdGVyaW5nIGV2ZW50XCIsIGV2ZW50TmFtZSk7XG4gICAgICBjbGllbnQub24oZXZlbnROYW1lLCBldmVudC5iaW5kKG51bGwsIGNsaWVudCkpO1xuICAgICAgZGVsZXRlIHJlcXVpcmVcbiAgICAgICAgLmNhY2hlW3JlcXVpcmUucmVzb2x2ZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcImV2ZW50c1wiLCBmaWxlKSldO1xuICAgIH0pO1xuICB9KTtcblxuICBjbGllbnQuY29tbWFuZHMgPSBuZXcgTWFwKCk7XG4gIHZhciBjb21tYW5kc1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBcImNvbW1hbmRzXCIpO1xuXG4gIGZzLnJlYWRkaXIoY29tbWFuZHNQYXRoLCBmdW5jdGlvbihlcnIsIGZpbGVzKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIGlmICghZmlsZS5lbmRzV2l0aChcIi5qc1wiKSkgcmV0dXJuO1xuICAgICAgdmFyIHByb3BzID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcImNvbW1hbmRzXCIsIGZpbGUpKTtcbiAgICAgIHZhciBjb21tYW5kTmFtZSA9IGZpbGUuc3BsaXQoXCIuXCIpWzBdO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIi0tcmVnaXN0ZXJpbmcgY29tbWFuZFwiLCBjb21tYW5kTmFtZSwgcHJvcHMpO1xuICAgICAgY2xpZW50LmNvbW1hbmRzLnNldChjb21tYW5kTmFtZSwgcHJvcHMpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIi0tc2V0IGNvbW1hbmRcIiwgY29tbWFuZE5hbWUsIHByb3BzKTtcbiAgICB9KTtcbiAgfSk7XG59XG4iXX0=
