"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("colors");
const fs = require("fs");
const path = require("path");
const ExitHandler_1 = require("../classes/ExitHandler");
const Resources_1 = require("../classes/Resources");
const boot_1 = require("../resources/boot");
module.exports = client => {
  client.user.setActivity(client.config.status);
  console.log(boot_1.default.red);
  ExitHandler_1.default.init(client);
  let commandArray = [...client.commands.keys()].sort();
  console.log(`Loaded ${commandArray.length.toString().magenta} command(s)`, "[@everyone]".green, "[@moderator]".yellow, "[@owner]".red);
  for (var i = 0; i < commandArray.length; i++) {
    var commandName = commandArray[i];
    var command = client.commands.get(commandName);
    commandName = `[${commandName}]`;
    if (command.props.requiresElevation && command.props.requiresElevation === client.config.elevation_names.moderator) console.log(commandArray[i].yellow + " - " + command.props.description);
    else if (command.props.requiresElevation && command.props.requiresElevation === client.config.elevation_names.owner) console.log(commandArray[i].red + " - " + command.props.description);
    else console.log(commandArray[i].green + " - " + command.props.description);
  }
  console.log("...");
  client.guilds.forEach(guild => {
    let guildDir = Resources_1.default.getGuildDirectoryFromGuild(guild);
    if (!fs.existsSync(guildDir)) {
      fs.mkdirSync(guildDir, { recursive: true });
      fs.mkdirSync(path.join(guildDir, client.config.files.removed), {
        recursive: true
      });
    }
    let guildName = Resources_1.default.getGuildNameFromGuild(guild);
    client.usersInSession[guildName] = {};
    console.log(`*Registered [${guildName.magenta}] to session --- looking for existing members:`);
    fs.readdirSync(guildDir).forEach(dir => {
      let username = dir;
      if (!client.hasUser(guild, username)) {
        let content = Resources_1.default.getUserContentsFromNameWithGuild(client, guild, null, username);
        if (content === null || typeof content === "undefined") return;
        process.stdout.write("  ");
        client.registerUser(content);
      }
    });
    console.log(`Found all existing members of [${guildName.magenta}] (currently ${Object.keys(client.getGuild(guildName)).length.toString().green})`);
  });
  let readyMessage = `Ready to serve in ${client.channels.size} channel(s) on ${client.guilds.size} guild(s), for a total of ${client.users.size} users`.inverse;
  let footer = "=====================================================================================".red;
  console.log(`...\n${readyMessage}\n${footer}`);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXZlbnRzL3JlYWR5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0JBQWdCO0FBR2hCLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFFN0Isd0RBQTBDO0FBQzFDLG9EQUF3QztBQUN4Qyw0Q0FBcUM7QUFFckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLE1BQVcsRUFBRSxFQUFFO0lBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEIscUJBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFbEIsSUFBSSxZQUFZLEdBQWEsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoRSxPQUFPLENBQUMsR0FBRyxDQUNULFVBQVUsWUFBWSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLGFBQWEsRUFDN0QsYUFBYSxDQUFDLEtBQUssRUFDbkIsY0FBYyxDQUFDLE1BQU0sRUFDckIsVUFBVSxDQUFDLEdBQUcsQ0FDZixDQUFDO0lBRUYsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDNUMsSUFBSSxXQUFXLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRS9DLFdBQVcsR0FBRyxJQUFJLFdBQVcsR0FBRyxDQUFDO1FBRWpDLElBQ0UsT0FBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUI7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QUksNkJBQTZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRO1NBQ25KLE9BQU8sQ0FBQztJQUNYLElBQUksTUFBTSxHQUFHLHVGQUF1RjtTQUNqRyxHQUFHLENBQUM7SUFFUCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsWUFBWSxLQUFLLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDakQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdjb2xvcnMnO1xyXG5cclxuaW1wb3J0IHsgR3VpbGQsIE1lc3NhZ2UgfSBmcm9tICdkaXNjb3JkLmpzJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuaW1wb3J0IGV4aXQgZnJvbSAnLi4vY2xhc3Nlcy9FeGl0SGFuZGxlcic7XHJcbmltcG9ydCByc3JjIGZyb20gJy4uL2NsYXNzZXMvUmVzb3VyY2VzJztcclxuaW1wb3J0IGJvb3QgZnJvbSAnLi4vcmVzb3VyY2VzL2Jvb3QnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSAoY2xpZW50OiBhbnkpID0+IHtcclxuICBjbGllbnQudXNlci5zZXRBY3Rpdml0eShjbGllbnQuY29uZmlnLnN0YXR1cyk7XHJcblxyXG4gIGNvbnNvbGUubG9nKGJvb3QucmVkKTtcclxuXHJcbiAgZXhpdC5pbml0KGNsaWVudCk7XHJcblxyXG4gIGxldCBjb21tYW5kQXJyYXk6IHN0cmluZ1tdID0gWy4uLmNsaWVudC5jb21tYW5kcy5rZXlzKCldLnNvcnQoKTtcclxuICBjb25zb2xlLmxvZyhcclxuICAgIGBMb2FkZWQgJHtjb21tYW5kQXJyYXkubGVuZ3RoLnRvU3RyaW5nKCkubWFnZW50YX0gY29tbWFuZChzKWAsXHJcbiAgICBcIltAZXZlcnlvbmVdXCIuZ3JlZW4sXHJcbiAgICBcIltAbW9kZXJhdG9yXVwiLnllbGxvdyxcclxuICAgIFwiW0Bvd25lcl1cIi5yZWRcclxuICApO1xyXG5cclxuICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbW1hbmRBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgdmFyIGNvbW1hbmROYW1lID0gY29tbWFuZEFycmF5W2ldO1xyXG4gICAgdmFyIGNvbW1hbmQgPSBjbGllbnQuY29tbWFuZHMuZ2V0KGNvbW1hbmROYW1lKTtcclxuXHJcbiAgICBjb21tYW5kTmFtZSA9IGBbJHtjb21tYW5kTmFtZX1dYDtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIGNvbW1hbmQucHJvcHMucmVxdWlyZXNFbGV2YXRpb24gJiZcclxuICAgICAgY29tbWFuZC5wcm9wcy5yZXF1aXJlc0VsZXZhdGlvbiA9PT1cclxuICAgICAgICBjbGllbnQuY29uZmlnLmVsZXZhdGlvbl9uYW1lcy5tb2RlcmF0b3JcclxuICAgIClcclxuICAgICAgY29uc29sZS5sb2coY29tbWFuZEFycmF5W2ldLnllbGxvdyArIFwiIC0gXCIgKyBjb21tYW5kLnByb3BzLmRlc2NyaXB0aW9uKTtcclxuICAgIGVsc2UgaWYgKFxyXG4gICAgICBjb21tYW5kLnByb3BzLnJlcXVpcmVzRWxldmF0aW9uICYmXHJcbiAgICAgIGNvbW1hbmQucHJvcHMucmVxdWlyZXNFbGV2YXRpb24gPT09IGNsaWVudC5jb25maWcuZWxldmF0aW9uX25hbWVzLm93bmVyXHJcbiAgICApXHJcbiAgICAgIGNvbnNvbGUubG9nKGNvbW1hbmRBcnJheVtpXS5yZWQgKyBcIiAtIFwiICsgY29tbWFuZC5wcm9wcy5kZXNjcmlwdGlvbik7XHJcbiAgICBlbHNlIGNvbnNvbGUubG9nKGNvbW1hbmRBcnJheVtpXS5ncmVlbiArIFwiIC0gXCIgKyBjb21tYW5kLnByb3BzLmRlc2NyaXB0aW9uKTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKFwiLi4uXCIpO1xyXG5cclxuICBjbGllbnQuZ3VpbGRzLmZvckVhY2goKGd1aWxkOiBHdWlsZCkgPT4ge1xyXG4gICAgbGV0IGd1aWxkRGlyID0gcnNyYy5nZXRHdWlsZERpcmVjdG9yeUZyb21HdWlsZChndWlsZCk7XHJcblxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGd1aWxkRGlyKSkge1xyXG4gICAgICBmcy5ta2RpclN5bmMoZ3VpbGREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gICAgICBmcy5ta2RpclN5bmMocGF0aC5qb2luKGd1aWxkRGlyLCBjbGllbnQuY29uZmlnLmZpbGVzLnJlbW92ZWQpLCB7XHJcbiAgICAgICAgcmVjdXJzaXZlOiB0cnVlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgbGV0IGd1aWxkTmFtZSA9IHJzcmMuZ2V0R3VpbGROYW1lRnJvbUd1aWxkKGd1aWxkKTtcclxuXHJcbiAgICAvL3NldCB0aGUgZ3VpbGQgZGF0YSB0byB0byB0aGUgZ3VpbGQgbmFtZVxyXG4gICAgY2xpZW50LnVzZXJzSW5TZXNzaW9uW2d1aWxkTmFtZV0gPSB7fTtcclxuICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICBgKlJlZ2lzdGVyZWQgWyR7Z3VpbGROYW1lLm1hZ2VudGF9XSB0byBzZXNzaW9uIC0tLSBsb29raW5nIGZvciBleGlzdGluZyBtZW1iZXJzOmBcclxuICAgICk7XHJcblxyXG4gICAgZnMucmVhZGRpclN5bmMoZ3VpbGREaXIpLmZvckVhY2goZGlyID0+IHtcclxuICAgICAgbGV0IHVzZXJuYW1lID0gZGlyO1xyXG5cclxuICAgICAgLy9pZiB0aGUgY2xpZW50IGRvZXMgbm90IGhhdmUgdGhlIHVzZXIgcmVnaXN0ZXJlZFxyXG4gICAgICBpZiAoIWNsaWVudC5oYXNVc2VyKGd1aWxkLCB1c2VybmFtZSkpIHtcclxuICAgICAgICBsZXQgY29udGVudCA9IHJzcmMuZ2V0VXNlckNvbnRlbnRzRnJvbU5hbWVXaXRoR3VpbGQoXHJcbiAgICAgICAgICBjbGllbnQsXHJcbiAgICAgICAgICBndWlsZCxcclxuICAgICAgICAgIChudWxsIGFzIHVua25vd24pIGFzIE1lc3NhZ2UsXHJcbiAgICAgICAgICB1c2VybmFtZVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKGNvbnRlbnQgPT09IG51bGwgfHwgdHlwZW9mIGNvbnRlbnQgPT09IFwidW5kZWZpbmVkXCIpIHJldHVybjtcclxuXHJcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCIgIFwiKTtcclxuICAgICAgICBjbGllbnQucmVnaXN0ZXJVc2VyKGNvbnRlbnQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcclxuICAgICAgYEZvdW5kIGFsbCBleGlzdGluZyBtZW1iZXJzIG9mIFske2d1aWxkTmFtZS5tYWdlbnRhfV0gKGN1cnJlbnRseSAke1xyXG4gICAgICAgIE9iamVjdC5rZXlzKGNsaWVudC5nZXRHdWlsZChndWlsZE5hbWUpKS5sZW5ndGgudG9TdHJpbmcoKS5ncmVlblxyXG4gICAgICB9KWBcclxuICAgICk7XHJcbiAgfSk7XHJcblxyXG4gIGxldCByZWFkeU1lc3NhZ2UgPSBgUmVhZHkgdG8gc2VydmUgaW4gJHtjbGllbnQuY2hhbm5lbHMuc2l6ZX0gY2hhbm5lbChzKSBvbiAke2NsaWVudC5ndWlsZHMuc2l6ZX0gZ3VpbGQocyksIGZvciBhIHRvdGFsIG9mICR7Y2xpZW50LnVzZXJzLnNpemV9IHVzZXJzYFxyXG4gICAgLmludmVyc2U7XHJcbiAgbGV0IGZvb3RlciA9IFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVwiXHJcbiAgICAucmVkO1xyXG5cclxuICBjb25zb2xlLmxvZyhgLi4uXFxuJHtyZWFkeU1lc3NhZ2V9XFxuJHtmb290ZXJ9YCk7XHJcbn07XHJcbiJdfQ==
