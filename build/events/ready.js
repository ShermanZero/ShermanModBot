"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("colors");
const fs = require("fs");
const path = require("path");
const ExitHandler_1 = require("../classes/ExitHandler");
const Resources_1 = require("../classes/Resources");
const boot_1 = require("../resources/misc/boot");
module.exports = (client) => {
    client.user.setActivity(client.config.status);
    console.log(boot_1.default.red);
    ExitHandler_1.default.init(client);
    let commandArray = [...client.commands.keys()].sort();
    console.log(`Loaded ${commandArray.length.toString().magenta} command(s)`, "[@everyone]".green, "[@moderator]".yellow, "[@owner]".red);
    for (var i = 0; i < commandArray.length; i++) {
        var commandName = commandArray[i];
        var command = client.commands.get(commandName);
        commandName = `[${commandName}]`;
        if (command.props.requiresElevation &&
            command.props.requiresElevation ===
                client.config.elevation_names.moderator)
            console.log(commandArray[i].yellow + " - " + command.props.description);
        else if (command.props.requiresElevation &&
            command.props.requiresElevation === client.config.elevation_names.owner)
            console.log(commandArray[i].red + " - " + command.props.description);
        else
            console.log(commandArray[i].green + " - " + command.props.description);
    }
    console.log("...");
    client.guilds.forEach((guild) => {
        let guildDir = Resources_1.default.getGuildDirectoryFromGuild(guild);
        if (!fs.existsSync(guildDir)) {
            fs.mkdirSync(guildDir, { recursive: true });
            fs.mkdirSync(path.join(guildDir, client.config.files.removed), {
                recursive: true
            });
        }
        let guildName = Resources_1.default.getGuildNameFromGuild(guild);
        client.usersInSession[guildName] = {};
        console.log(`*Registered [${guildName.magenta}] to session --- looking for existing members:`);
        fs.readdirSync(guildDir).forEach(dir => {
            let username = dir;
            if (!client.hasUser(guild, username)) {
                let content = Resources_1.default.getUserContentsFromNameWithGuild(client, guild, null, username);
                if (content === null || typeof content === "undefined")
                    return;
                process.stdout.write("  ");
                client.registerUser(content);
            }
        });
        console.log(`Found all existing members of [${guildName.magenta}] (currently ${Object.keys(client.getGuild(guildName)).length.toString().green})`);
    });
    let readyMessage = `Ready to serve in ${client.channels.size} channel(s) on ${client.guilds.size} guild(s), for a total of ${client.users.size} users`
        .inverse;
    let footer = "====================================================================================="
        .red;
    console.log(`...\n${readyMessage}\n${footer}`);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXZlbnRzL3JlYWR5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0JBQWdCO0FBR2hCLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFFN0Isd0RBQTBDO0FBQzFDLG9EQUF3QztBQUN4QyxpREFBMEM7QUFFMUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLE1BQVcsRUFBRSxFQUFFO0lBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEIscUJBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFbEIsSUFBSSxZQUFZLEdBQWEsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoRSxPQUFPLENBQUMsR0FBRyxDQUNULFVBQVUsWUFBWSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLGFBQWEsRUFDN0QsYUFBYSxDQUFDLEtBQUssRUFDbkIsY0FBYyxDQUFDLE1BQU0sRUFDckIsVUFBVSxDQUFDLEdBQUcsQ0FDZixDQUFDO0lBRUYsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDNUMsSUFBSSxXQUFXLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRS9DLFdBQVcsR0FBRyxJQUFJLFdBQVcsR0FBRyxDQUFDO1FBRWpDLElBQ0UsT0FBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUI7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QUksNkJBQTZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRO1NBQ25KLE9BQU8sQ0FBQztJQUNYLElBQUksTUFBTSxHQUFHLHVGQUF1RjtTQUNqRyxHQUFHLENBQUM7SUFFUCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsWUFBWSxLQUFLLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDakQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdjb2xvcnMnO1xyXG5cclxuaW1wb3J0IHsgR3VpbGQsIE1lc3NhZ2UgfSBmcm9tICdkaXNjb3JkLmpzJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuaW1wb3J0IGV4aXQgZnJvbSAnLi4vY2xhc3Nlcy9FeGl0SGFuZGxlcic7XHJcbmltcG9ydCByc3JjIGZyb20gJy4uL2NsYXNzZXMvUmVzb3VyY2VzJztcclxuaW1wb3J0IGJvb3QgZnJvbSAnLi4vcmVzb3VyY2VzL21pc2MvYm9vdCc7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IChjbGllbnQ6IGFueSkgPT4ge1xyXG4gIGNsaWVudC51c2VyLnNldEFjdGl2aXR5KGNsaWVudC5jb25maWcuc3RhdHVzKTtcclxuXHJcbiAgY29uc29sZS5sb2coYm9vdC5yZWQpO1xyXG5cclxuICBleGl0LmluaXQoY2xpZW50KTtcclxuXHJcbiAgbGV0IGNvbW1hbmRBcnJheTogc3RyaW5nW10gPSBbLi4uY2xpZW50LmNvbW1hbmRzLmtleXMoKV0uc29ydCgpO1xyXG4gIGNvbnNvbGUubG9nKFxyXG4gICAgYExvYWRlZCAke2NvbW1hbmRBcnJheS5sZW5ndGgudG9TdHJpbmcoKS5tYWdlbnRhfSBjb21tYW5kKHMpYCxcclxuICAgIFwiW0BldmVyeW9uZV1cIi5ncmVlbixcclxuICAgIFwiW0Btb2RlcmF0b3JdXCIueWVsbG93LFxyXG4gICAgXCJbQG93bmVyXVwiLnJlZFxyXG4gICk7XHJcblxyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY29tbWFuZEFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICB2YXIgY29tbWFuZE5hbWUgPSBjb21tYW5kQXJyYXlbaV07XHJcbiAgICB2YXIgY29tbWFuZCA9IGNsaWVudC5jb21tYW5kcy5nZXQoY29tbWFuZE5hbWUpO1xyXG5cclxuICAgIGNvbW1hbmROYW1lID0gYFske2NvbW1hbmROYW1lfV1gO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgY29tbWFuZC5wcm9wcy5yZXF1aXJlc0VsZXZhdGlvbiAmJlxyXG4gICAgICBjb21tYW5kLnByb3BzLnJlcXVpcmVzRWxldmF0aW9uID09PVxyXG4gICAgICAgIGNsaWVudC5jb25maWcuZWxldmF0aW9uX25hbWVzLm1vZGVyYXRvclxyXG4gICAgKVxyXG4gICAgICBjb25zb2xlLmxvZyhjb21tYW5kQXJyYXlbaV0ueWVsbG93ICsgXCIgLSBcIiArIGNvbW1hbmQucHJvcHMuZGVzY3JpcHRpb24pO1xyXG4gICAgZWxzZSBpZiAoXHJcbiAgICAgIGNvbW1hbmQucHJvcHMucmVxdWlyZXNFbGV2YXRpb24gJiZcclxuICAgICAgY29tbWFuZC5wcm9wcy5yZXF1aXJlc0VsZXZhdGlvbiA9PT0gY2xpZW50LmNvbmZpZy5lbGV2YXRpb25fbmFtZXMub3duZXJcclxuICAgIClcclxuICAgICAgY29uc29sZS5sb2coY29tbWFuZEFycmF5W2ldLnJlZCArIFwiIC0gXCIgKyBjb21tYW5kLnByb3BzLmRlc2NyaXB0aW9uKTtcclxuICAgIGVsc2UgY29uc29sZS5sb2coY29tbWFuZEFycmF5W2ldLmdyZWVuICsgXCIgLSBcIiArIGNvbW1hbmQucHJvcHMuZGVzY3JpcHRpb24pO1xyXG4gIH1cclxuXHJcbiAgY29uc29sZS5sb2coXCIuLi5cIik7XHJcblxyXG4gIGNsaWVudC5ndWlsZHMuZm9yRWFjaCgoZ3VpbGQ6IEd1aWxkKSA9PiB7XHJcbiAgICBsZXQgZ3VpbGREaXIgPSByc3JjLmdldEd1aWxkRGlyZWN0b3J5RnJvbUd1aWxkKGd1aWxkKTtcclxuXHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZ3VpbGREaXIpKSB7XHJcbiAgICAgIGZzLm1rZGlyU3luYyhndWlsZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgIGZzLm1rZGlyU3luYyhwYXRoLmpvaW4oZ3VpbGREaXIsIGNsaWVudC5jb25maWcuZmlsZXMucmVtb3ZlZCksIHtcclxuICAgICAgICByZWN1cnNpdmU6IHRydWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBsZXQgZ3VpbGROYW1lID0gcnNyYy5nZXRHdWlsZE5hbWVGcm9tR3VpbGQoZ3VpbGQpO1xyXG5cclxuICAgIC8vc2V0IHRoZSBndWlsZCBkYXRhIHRvIHRvIHRoZSBndWlsZCBuYW1lXHJcbiAgICBjbGllbnQudXNlcnNJblNlc3Npb25bZ3VpbGROYW1lXSA9IHt9O1xyXG4gICAgY29uc29sZS5sb2coXHJcbiAgICAgIGAqUmVnaXN0ZXJlZCBbJHtndWlsZE5hbWUubWFnZW50YX1dIHRvIHNlc3Npb24gLS0tIGxvb2tpbmcgZm9yIGV4aXN0aW5nIG1lbWJlcnM6YFxyXG4gICAgKTtcclxuXHJcbiAgICBmcy5yZWFkZGlyU3luYyhndWlsZERpcikuZm9yRWFjaChkaXIgPT4ge1xyXG4gICAgICBsZXQgdXNlcm5hbWUgPSBkaXI7XHJcblxyXG4gICAgICAvL2lmIHRoZSBjbGllbnQgZG9lcyBub3QgaGF2ZSB0aGUgdXNlciByZWdpc3RlcmVkXHJcbiAgICAgIGlmICghY2xpZW50Lmhhc1VzZXIoZ3VpbGQsIHVzZXJuYW1lKSkge1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gcnNyYy5nZXRVc2VyQ29udGVudHNGcm9tTmFtZVdpdGhHdWlsZChcclxuICAgICAgICAgIGNsaWVudCxcclxuICAgICAgICAgIGd1aWxkLFxyXG4gICAgICAgICAgKG51bGwgYXMgdW5rbm93bikgYXMgTWVzc2FnZSxcclxuICAgICAgICAgIHVzZXJuYW1lXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoY29udGVudCA9PT0gbnVsbCB8fCB0eXBlb2YgY29udGVudCA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xyXG5cclxuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIiAgXCIpO1xyXG4gICAgICAgIGNsaWVudC5yZWdpc3RlclVzZXIoY29udGVudCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICBgRm91bmQgYWxsIGV4aXN0aW5nIG1lbWJlcnMgb2YgWyR7Z3VpbGROYW1lLm1hZ2VudGF9XSAoY3VycmVudGx5ICR7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoY2xpZW50LmdldEd1aWxkKGd1aWxkTmFtZSkpLmxlbmd0aC50b1N0cmluZygpLmdyZWVuXHJcbiAgICAgIH0pYFxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgbGV0IHJlYWR5TWVzc2FnZSA9IGBSZWFkeSB0byBzZXJ2ZSBpbiAke2NsaWVudC5jaGFubmVscy5zaXplfSBjaGFubmVsKHMpIG9uICR7Y2xpZW50Lmd1aWxkcy5zaXplfSBndWlsZChzKSwgZm9yIGEgdG90YWwgb2YgJHtjbGllbnQudXNlcnMuc2l6ZX0gdXNlcnNgXHJcbiAgICAuaW52ZXJzZTtcclxuICBsZXQgZm9vdGVyID0gXCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XCJcclxuICAgIC5yZWQ7XHJcblxyXG4gIGNvbnNvbGUubG9nKGAuLi5cXG4ke3JlYWR5TWVzc2FnZX1cXG4ke2Zvb3Rlcn1gKTtcclxufTtcclxuIl19